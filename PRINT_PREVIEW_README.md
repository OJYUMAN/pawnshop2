# ระบบพรีวิวและเลือกเครื่องปริ้น

## ภาพรวม
ระบบใหม่นี้เพิ่มความสามารถในการพรีวิวเอกสารก่อนปริ้นและให้ผู้ใช้เลือกได้ว่าจะปริ้นกับเครื่องปริ้นหรือบันทึกเป็นไฟล์ PDF

## ฟีเจอร์หลัก

### 1. หน้าตาพรีวิวเอกสาร
- แสดงตัวอย่างเอกสารก่อนปริ้น
- เปิดเอกสารด้วยโปรแกรมอ่าน PDF ภายนอก
- รีเฟรชตัวอย่างได้

### 2. ตัวเลือกการปริ้น
- **ปริ้นกับเครื่องปริ้น**: เลือกเครื่องปริ้นที่ต้องการ
- **บันทึกเป็น PDF**: เลือกตำแหน่งบันทึกไฟล์

### 3. รองรับทั้งสองประเภทสัญญา
- สัญญาฝากขาย (Pawn Contract)
- สัญญาไถ่คืน (Redemption Contract)

## การใช้งาน

### สำหรับสัญญาฝากขาย
1. กรอกข้อมูลสัญญาในหน้าหลัก
2. คลิกปุ่ม "สร้างใบขายฝาก"
3. ระบบจะเปิดหน้าตาพรีวิว
4. ตรวจสอบเอกสารในโปรแกรมอ่าน PDF
5. เลือกการดำเนินการ:
   - ปริ้นกับเครื่องปริ้นที่เลือก
   - บันทึกเป็นไฟล์ PDF

### สำหรับสัญญาไถ่คืน
1. เปิดหน้าต่างไถ่คืนสัญญา
2. กรอกข้อมูลการไถ่คืน
3. คลิกปุ่ม "สร้างสัญญาไถ่คืน"
4. ระบบจะเปิดหน้าตาพรีวิว
5. เลือกการดำเนินการตามต้องการ

## ไฟล์ที่เกี่ยวข้อง

### ไฟล์หลัก
- `print_preview_dialog.py` - หน้าตาพรีวิวและเลือกเครื่องปริ้น
- `main.py` - ระบบหลัก (แก้ไขฟังก์ชัน `generate_pawn_contract_pdf`)
- `dialogs.py` - หน้าต่างไถ่คืน (แก้ไขฟังก์ชัน `generate_redemption_contract_pdf`)

### ไฟล์ทดสอบ
- `test_print_preview.py` - ทดสอบระบบพรีวิว

## การติดตั้งและใช้งาน

### 1. ตรวจสอบ dependencies
```bash
pip install PySide6 reportlab
```

### 2. รันโปรแกรมหลัก
```bash
python main.py
```

### 3. ทดสอบระบบพรีวิว
```bash
python test_print_preview.py
```

## ข้อกำหนดระบบ

### ระบบปฏิบัติการ
- Windows: รองรับการค้นหาเครื่องปริ้นผ่าน wmic
- macOS: รองรับการค้นหาเครื่องปริ้นผ่าน lpstat
- Linux: รองรับการค้นหาเครื่องปริ้นผ่าน lpstat

### โปรแกรมที่จำเป็น
- โปรแกรมอ่าน PDF (เช่น Adobe Reader, Preview, etc.)
- เครื่องปริ้นที่ติดตั้งในระบบ (สำหรับการปริ้น)

## การแก้ไขปัญหา

### ปัญหาที่อาจเกิดขึ้น
1. **ไม่พบเครื่องปริ้น**: ตรวจสอบว่าเครื่องปริ้นติดตั้งและเชื่อมต่อแล้ว
2. **ไม่สามารถเปิด PDF**: ตรวจสอบว่ามีโปรแกรมอ่าน PDF ติดตั้งแล้ว
3. **ข้อผิดพลาดในการสร้าง PDF**: ตรวจสอบข้อมูลสัญญาให้ครบถ้วน

### การแก้ไข
1. ตรวจสอบ log ใน console
2. ตรวจสอบข้อมูลสัญญา
3. ตรวจสอบการติดตั้ง dependencies

## การพัฒนาต่อ

### ฟีเจอร์ที่สามารถเพิ่มได้
1. การตั้งค่าความละเอียดการปริ้น
2. การเลือกขนาดกระดาษ
3. การตั้งค่าคุณภาพการปริ้น
4. การบันทึกการตั้งค่าล่าสุด

### การปรับแต่ง
- แก้ไข UI ใน `print_preview_dialog.py`
- เพิ่มฟังก์ชันใหม่ใน `PrintPreviewDialog` class
- ปรับแต่งการค้นหาเครื่องปริ้นใน `load_printers()` method

## หมายเหตุ
- ระบบจะสร้างไฟล์ PDF ชั่วคราวในโฟลเดอร์ temp
- ไฟล์ชั่วคราวจะถูกลบอัตโนมัติเมื่อปิดหน้าต่าง
- ระบบรองรับการทำงานแบบ offline

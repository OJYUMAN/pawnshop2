# ระบบค้นหาสัญญาใหม่

## ภาพรวม
ระบบค้นหาสัญญาได้รับการปรับปรุงให้สามารถเลือกคีย์ค้นหาได้ 3 แบบ:

1. **เลขที่สัญญา** - ค้นหาตามเลขที่สัญญา
2. **เลขบัตรประชาชน** - ค้นหาตามเลขบัตรประชาชนของลูกค้า
3. **ชื่อนามสกุล** - ค้นหาตามชื่อและนามสกุลของลูกค้า

## การใช้งาน

### 1. เลือกประเภทการค้นหา
- ใช้ ComboBox "ค้นหาตาม:" เพื่อเลือกประเภทการค้นหา
- ระบบจะแสดงฟอร์มที่เหมาะสมตามประเภทที่เลือก

### 2. การค้นหาตามเลขที่สัญญา
- เลือก "เลขที่สัญญา"
- กรอกเลขที่สัญญาในช่อง "เลขที่สัญญา"
- เลือกเงื่อนไขการเปรียบเทียบ (=, >, <, >=, <=)
- กดปุ่ม "ค้นหา"

### 3. การค้นหาตามเลขบัตรประชาชน
- เลือก "เลขบัตรประชาชน"
- กรอกเลขบัตรประชาชนในช่อง "เลขบัตรประชาชน"
- กดปุ่ม "ค้นหา"

### 4. การค้นหาตามชื่อนามสกุล
- เลือก "ชื่อนามสกุล"
- กรอกชื่อในช่อง "ชื่อ" และ/หรือ นามสกุลในช่อง "นามสกุล"
- ต้องกรอกอย่างน้อยหนึ่งช่อง
- กดปุ่ม "ค้นหา"

### 5. ตัวเลือกสถานะสัญญา
- **สัญญาเปิด** - แสดงเฉพาะสัญญาที่ยังไม่ไถ่ถอน
- **สัญญาปิด** - แสดงเฉพาะสัญญาที่ไถ่ถอนแล้ว
- **ทั้งหมด** - แสดงสัญญาทั้งหมด

### 6. ปุ่มควบคุม
- **ค้นหา** - ดำเนินการค้นหาตามเงื่อนไขที่กำหนด
- **ล้างการค้นหา** - ล้างข้อมูลการค้นหาและผลลัพธ์

## ฟีเจอร์ใหม่

### การแสดงผลแบบไดนามิก
- ฟอร์มค้นหาจะเปลี่ยนตามประเภทที่เลือก
- ฟิลด์ที่ไม่เกี่ยวข้องจะถูกซ่อนไว้

### การตรวจสอบข้อมูล
- ตรวจสอบว่ากรอกข้อมูลครบถ้วนหรือไม่
- แสดงข้อความแจ้งเตือนที่เหมาะสม

### การจัดการข้อผิดพลาด
- จัดการข้อผิดพลาดที่อาจเกิดขึ้นระหว่างการค้นหา
- แสดงข้อความแจ้งเตือนที่ชัดเจน

## การปรับปรุงฐานข้อมูล

### ฟังก์ชันใหม่ที่เพิ่มเข้ามา
- `search_contracts_by_number()` - ค้นหาตามเลขที่สัญญา
- `search_contracts_by_id_card()` - ค้นหาตามเลขบัตรประชาชน
- `search_contracts_by_name()` - ค้นหาตามชื่อนามสกุล
- `get_contracts_by_customer()` - ดึงสัญญาของลูกค้าคนหนึ่ง

### การปรับปรุงฟังก์ชันเดิม
- `search_contracts()` - เปลี่ยนเป็น legacy function
- เรียกใช้ฟังก์ชันใหม่ตามประเภทการค้นหา

## การใช้งานในโค้ด

### ตัวอย่างการเรียกใช้
```python
# ค้นหาตามเลขที่สัญญา
contracts = self.db.search_contracts_by_number("CN001", "active")

# ค้นหาตามเลขบัตรประชาชน
contracts = self.db.search_contracts_by_id_card("1234567890123", "all")

# ค้นหาตามชื่อนามสกุล
contracts = self.db.search_contracts_by_name("สมชาย", "ใจดี", "active")
```

## ข้อควรระวัง

1. **การเชื่อมต่อฐานข้อมูล** - ตรวจสอบว่าฐานข้อมูลเชื่อมต่อได้ปกติ
2. **สิทธิ์การเข้าถึง** - ตรวจสอบสิทธิ์การอ่านข้อมูลในฐานข้อมูล
3. **การแสดงผล** - ผลการค้นหาจะแสดงในตารางด้านล่าง

## การแก้ไขปัญหา

### ปัญหาที่พบบ่อย
1. **ไม่พบข้อมูล** - ตรวจสอบการสะกดและรูปแบบข้อมูล
2. **ข้อผิดพลาดฐานข้อมูล** - ตรวจสอบการเชื่อมต่อและโครงสร้างฐานข้อมูล
3. **การแสดงผลไม่ถูกต้อง** - ตรวจสอบการอัปเดต UI

### การแก้ไข
- ใช้ปุ่ม "ล้างการค้นหา" เพื่อรีเซ็ตระบบ
- ตรวจสอบข้อมูลในฐานข้อมูลโดยตรง
- รีสตาร์ทโปรแกรมหากเกิดปัญหาอย่างรุนแรง

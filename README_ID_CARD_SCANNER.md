# ระบบสแกนบัตรประชาชน

## ภาพรวม
ระบบสแกนบัตรประชาชนเป็นฟีเจอร์ที่เพิ่มเข้ามาในระบบจัดการข้อมูลลูกค้า เพื่อให้สามารถอ่านข้อมูลจากบัตรประชาชนไทยได้โดยอัตโนมัติ

## คุณสมบัติ
- อ่านข้อมูลบัตรประชาชนไทยแบบ Smart Card
- แสดงข้อมูลที่ได้จากบัตร (ชื่อ, เลขบัตร, วันเกิด, ที่อยู่, รูปภาพ)
- กรอกข้อมูลลงในฟอร์มเพิ่มลูกค้าอัตโนมัติ
- บันทึกรูปภาพจากบัตร
- รองรับการทำงานในเธรดแยก (ไม่ทำให้ UI ค้าง)

## ข้อกำหนดระบบ
- ระบบปฏิบัติการ: Windows, macOS, Linux
- Card Reader ที่รองรับ PC/SC
- บัตรประชาชนไทยแบบ Smart Card
- Python 3.7+

## การติดตั้ง

### 1. ติดตั้ง Dependencies
```bash
pip install -r requirements.txt
```

### 2. ติดตั้ง PC/SC Service
#### Windows
- ติดตั้ง Windows Smart Card Framework (โดยปกติจะติดตั้งมาแล้ว)
- หรือติดตั้งจาก Microsoft Store

#### macOS
```bash
brew install pcsc-lite
```

#### Linux (Ubuntu/Debian)
```bash
sudo apt-get install pcscd libpcsclite1
sudo systemctl enable pcscd
sudo systemctl start pcscd
```

#### Linux (CentOS/RHEL)
```bash
sudo yum install pcsc-lite pcsc-lite-devel
sudo systemctl enable pcscd
sudo systemctl start pcscd
```

### 3. ตรวจสอบ Card Reader
```bash
# ตรวจสอบว่ามี card reader หรือไม่
python -c "from smartcard.System import readers; print(readers())"
```

## การใช้งาน

### 1. เปิดหน้าจอเพิ่มข้อมูลลูกค้า
- ไปที่เมนู "ค้นหาลูกค้า"
- คลิกปุ่ม "เพิ่มลูกค้าใหม่"

### 2. สแกนบัตรประชาชน
- ใส่บัตรประชาชนใน card reader
- คลิกปุ่ม "สแกนบัตรประชาชน" (สีน้ำเงิน)
- รอการอ่านข้อมูล (จะแสดง progress bar)
- ระบบจะแสดงข้อมูลที่ได้จากบัตร

### 3. ยืนยันข้อมูล
- ตรวจสอบข้อมูลที่ได้จากบัตร
- คลิก "ใช่" เพื่อใช้ข้อมูล หรือ "ไม่ใช่" เพื่อยกเลิก
- ข้อมูลจะถูกกรอกลงในฟอร์มอัตโนมัติ

### 4. บันทึกข้อมูล
- กรอกข้อมูลเพิ่มเติมที่จำเป็น
- คลิกปุ่ม "บันทึก"

## ข้อมูลที่อ่านได้จากบัตร

| ฟิลด์ | คำอธิบาย | ตัวอย่าง |
|-------|----------|----------|
| CID | เลขบัตรประชาชน | 1234567890123 |
| TH_Fullname | ชื่อ-นามสกุล (ภาษาไทย) | สมชาย ใจดี |
| EN_Fullname | ชื่อ-นามสกุล (ภาษาอังกฤษ) | SOMCHAI JAIDEE |
| Date_of_birth | วันเกิด | 01/01/1990 |
| Gender | เพศ | 1 (ชาย), 2 (หญิง) |
| Card_Issuer | หน่วยที่ออกบัตร | สำนักงานเขตบางแค |
| Issue_Date | วันออกบัตร | 01/01/2020 |
| Expire_Date | วันหมดอายุ | 01/01/2030 |
| Address | ที่อยู่ | 123 ถนนสุขุมวิท |
| Photo | รูปภาพ | ไฟล์ JPG |

## การแก้ไขปัญหา

### ปัญหา: ไม่พบ card reader
**สาเหตุ:** Card reader ไม่ได้เชื่อมต่อหรือ driver ไม่ได้ติดตั้ง
**วิธีแก้:**
1. ตรวจสอบการเชื่อมต่อ USB
2. ติดตั้ง driver ของ card reader
3. ตรวจสอบว่า PC/SC service ทำงานอยู่

### ปัญหา: ไม่พบบัตร
**สาเหตุ:** บัตรไม่ได้ใส่หรือใส่ไม่ถูกต้อง
**วิธีแก้:**
1. ตรวจสอบว่าบัตรใส่ในทิศทางที่ถูกต้อง
2. ลบและใส่บัตรใหม่
3. ทำความสะอาดหน้าสัมผัสของบัตร

### ปัญหา: ImportError: No module named 'smartcard'
**สาเหตุ:** โมดูล pyscard ไม่ได้ติดตั้ง
**วิธีแก้:**
```bash
pip install pyscard
```

### ปัญหา: ไม่สามารถอ่านข้อมูลได้
**สาเหตุ:** บัตรเสียหายหรือ card reader ไม่รองรับ
**วิธีแก้:**
1. ลองใช้ card reader อื่น
2. ตรวจสอบว่าบัตรยังใช้งานได้
3. ลองใช้บัตรอื่น

## การพัฒนาต่อ

### เพิ่มฟิลด์ใหม่
```python
# ในเมธอด read_thai_id_card
commands = {
    # ฟิลด์เดิม...
    "New_Field": [0x80, 0xb0, 0x00, 0xXX, 0x02, 0x00, 0xYY]
}
```

### ปรับแต่งการแสดงผล
```python
# ในเมธอด on_card_data_ready
# ปรับแต่งการแสดงข้อมูลที่ได้จากบัตร
```

### เพิ่มการตรวจสอบความถูกต้อง
```python
# เพิ่มการตรวจสอบความถูกต้องของข้อมูล
# เช่น ตรวจสอบรูปแบบวันเกิด, เลขบัตร
```

## หมายเหตุ
- ระบบนี้ใช้เฉพาะกับบัตรประชาชนไทย
- ข้อมูลที่ได้อาจแตกต่างกันตามรุ่นของบัตร
- ควรตรวจสอบความถูกต้องของข้อมูลก่อนบันทึก
- รูปภาพจะถูกบันทึกในโฟลเดอร์ `product_images/`

## การสนับสนุน
หากพบปัญหาหรือต้องการความช่วยเหลือ กรุณาติดต่อทีมพัฒนา

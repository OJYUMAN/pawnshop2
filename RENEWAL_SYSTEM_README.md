# ระบบต่อดอก (Renewal System)

## ภาพรวม
ระบบต่อดอกเป็นฟีเจอร์ที่ช่วยให้ลูกค้าสามารถขยายเวลาการไถ่ถอนสินค้าได้ โดยการชำระค่าธรรมเนียม ค่าปรับ หรือส่วนลด

## ฟีเจอร์หลัก

### 1. หน้าต่างต่อดอก
- แสดงข้อมูลสัญญา (เลขที่สัญญา, ชื่อลูกค้า, ยอดฝาก, อัตราดอกเบี้ย)
- คำนวณจำนวนวันฝากนับถึงปัจจุบัน
- ระบุจำนวนครั้งที่ต่อดอก
- กรอกค่าธรรมเนียม, ค่าปรับ, ส่วนลด
- กำหนดวันที่ต่อดอก, วันครบกำหนดปัจจุบัน, วันครบกำหนดใหม่
- คำนวณยอดรวมอัตโนมัติ

### 2. การเก็บข้อมูล
- บันทึกข้อมูลการต่อดอกในตาราง `renewals`
- อัปเดตวันที่ครบกำหนดใหม่ในสัญญา
- เก็บประวัติการต่อดอกทั้งหมด

### 3. การแสดงผล
- ตารางแสดงข้อมูลการต่อดอกทั้งหมด
- รายงานการต่อดอกประจำวัน
- รายงานสรุปการต่อดอก

## การใช้งาน

### การต่อดอก
1. เลือกสัญญาที่ต้องการต่อดอก
2. คลิกปุ่ม "ต่อดอก" ในแถบเครื่องมือ
3. กรอกข้อมูลการต่อดอกในหน้าต่างที่เปิดขึ้น
4. คลิก "ตกลง" เพื่อบันทึก

### การดูข้อมูล
1. เมนู "ไฟล์" > "ดูข้อมูลการต่อดอก"
2. เมนู "รายงาน" > "รายงานการต่อดอก"

## โครงสร้างฐานข้อมูล

### ตาราง `renewals`
```sql
CREATE TABLE renewals (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    contract_id INTEGER NOT NULL,
    renewal_count INTEGER NOT NULL,
    fee_amount REAL DEFAULT 0,
    penalty_amount REAL DEFAULT 0,
    discount_amount REAL DEFAULT 0,
    total_amount REAL NOT NULL,
    renewal_date DATE NOT NULL,
    current_due_date DATE NOT NULL,
    new_due_date DATE NOT NULL,
    deposit_days INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (contract_id) REFERENCES contracts (id)
);
```

## ฟังก์ชันหลัก

### `add_renewal(renewal_data)`
เพิ่มข้อมูลการต่อดอกใหม่

### `update_contract_due_date(contract_id, new_due_date)`
อัปเดตวันที่ครบกำหนดใหม่ในสัญญา

### `get_renewals_by_contract(contract_id)`
ดึงข้อมูลการต่อดอกตามสัญญา

### `get_all_renewals()`
ดึงข้อมูลการต่อดอกทั้งหมด

## การคำนวณ

### ยอดรวม
```
ยอดรวม = ค่าธรรมเนียม + ค่าปรับ - ส่วนลด
```

### จำนวนวันฝาก
```
จำนวนวันฝาก = วันที่ปัจจุบัน - วันที่เริ่มต้นสัญญา
```

## การแสดงผลในตาราง

ตารางแสดงข้อมูลการต่อดอกประกอบด้วย:
1. ลำดับ
2. เลขที่สัญญา
3. ชื่อลูกค้า
4. ชื่อสินค้า
5. ต่อดอกครั้งที่
6. ค่าธรรมเนียม
7. ค่าปรับ
8. ส่วนลด
9. รวม
10. วันต่อดอก
11. วันครบกำหนดใหม่

## การรายงาน

### รายงานประจำวัน
- จำนวนการต่อดอก
- ยอดรวมการต่อดอก

### รายงานการต่อดอก
- สรุปจำนวนการต่อดอกทั้งหมด
- แยกตามประเภท (ค่าธรรมเนียม, ค่าปรับ, ส่วนลด)
- จัดกลุ่มตามสัญญา

## การเชื่อมต่อกับระบบอื่น

- **ระบบสัญญา**: อัปเดตวันที่ครบกำหนดใหม่
- **ระบบรายงาน**: เพิ่มข้อมูลการต่อดอกในรายงานประจำวัน
- **ระบบลูกค้า**: แสดงประวัติการต่อดอกของลูกค้า

## การตั้งค่า

ระบบต่อดอกใช้การตั้งค่าเริ่มต้นจากระบบหลัก:
- อัตราดอกเบี้ยเริ่มต้น
- จำนวนวันเริ่มต้น
- อัตราหัก ณ ที่จ่าย

## การบำรุงรักษา

- ตรวจสอบความถูกต้องของข้อมูลการต่อดอก
- สำรองข้อมูลตาราง `renewals` เป็นประจำ
- ตรวจสอบการเชื่อมโยงข้อมูลกับตารางอื่น

## การพัฒนาต่อ

- เพิ่มระบบแจ้งเตือนการต่อดอก
- เพิ่มการคำนวณดอกเบี้ยเพิ่มเติม
- เพิ่มระบบส่วนลดอัตโนมัติ
- เพิ่มการส่งรายงานการต่อดอกทางอีเมล
